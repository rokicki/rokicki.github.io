!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.alg=t():e.alg=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){var r=function(){var e=function(e,t,n,r){for(n=n||{},r=e.length;r--;n[e[r]]=t);return n},t=[2,14],n=[1,5],r=[5,23,24,25,27],a=[1,23],s=[1,18],i=[1,19],o=[1,22],u=[1,16],c=[1,17],l=[1,12],h=[1,13],p=[5,7,12,13,15,21,23,24,25,26,27,30,31],m=[5,19,23,24,25,27],f=[5,12,13,19,23,24,25,27,30,31],v=[5,7,12,13,15,19,21,23,24,25,26,27,30,31],y=[5,7,10,12,13,19,23,24,25,27,30,31],g=[7,12,13,15,21,24,26,30,31],_={trace:function(){},yy:{},symbols_:{error:2,expressions:3,TOP_LEVEL_ALG:4,EOF:5,LAYER:6,NUMBER:7,REPETITION:8,AMOUNT:9,PRIME:10,COMMENT:11,COMMENT_SHORT:12,COMMENT_LONG:13,FAMILY:14,LONG_FAMILY:15,SIGN_MOVE:16,DASH:17,OPTIONAL_WHITESPACE:18,WHITESPACE:19,REPEATABLE_UNIT:20,OPEN_BRACKET:21,SEQUENCE:22,COMMA:23,CLOSE_BRACKET:24,COLON:25,OPEN_PARENTHESIS:26,CLOSE_PARENTHESIS:27,REPEATED_UNIT:28,ANNOTATION:29,NEWLINE:30,PAUSE:31,UNIT_LIST_WITHOUT_WHITESPACE:32,UNIT_LIST:33,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",7:"NUMBER",10:"PRIME",12:"COMMENT_SHORT",13:"COMMENT_LONG",15:"LONG_FAMILY",17:"DASH",19:"WHITESPACE",21:"OPEN_BRACKET",23:"COMMA",24:"CLOSE_BRACKET",25:"COLON",26:"OPEN_PARENTHESIS",27:"CLOSE_PARENTHESIS",30:"NEWLINE",31:"PAUSE"},productions_:[0,[3,2],[6,1],[8,1],[9,1],[9,2],[9,1],[11,1],[11,1],[14,1],[16,1],[16,2],[16,4],[18,2],[18,0],[20,1],[20,5],[20,5],[20,3],[20,1],[20,5],[20,5],[20,3],[28,1],[28,2],[29,1],[29,1],[29,1],[32,1],[32,3],[32,2],[32,2],[32,1],[33,1],[33,3],[22,3],[22,1],[4,1]],performAction:function(e,t,n,r,a,s,i){var o=s.length-1;switch(a){case 1:return s[o-1];case 2:case 3:this.$=parseInt(s[o]);break;case 5:this.$=-s[o-1];break;case 6:this.$=-1;break;case 7:this.$={type:"commentShort",comment:s[o].slice(2)};break;case 8:this.$={type:"commentLong",comment:s[o].slice(2,-2)};break;case 10:this.$={type:"signMove",family:s[o]};break;case 11:this.$={type:"signMove",family:s[o],innerLayer:s[o-1]};break;case 12:this.$={type:"signMove",family:s[o],outerLayer:s[o-3],innerLayer:s[o-1]};break;case 16:case 20:this.$={type:"commutator",A:s[o-3],B:s[o-1]};break;case 17:case 21:this.$={type:"conjugate",A:s[o-3],B:s[o-1]};break;case 18:case 22:this.$={type:"group",nestedSequence:s[o-1]};break;case 23:s[o].amount=1,this.$=s[o];break;case 24:s[o-1].amount=s[o],this.$=s[o-1];break;case 25:this.$={type:"newLine"};break;case 26:this.$={type:"pause"};break;case 28:case 32:this.$=[s[o]];break;case 29:this.$=s[o-2].concat([s[o-1]]).concat(s[o]);break;case 30:this.$=[s[o-1]].concat(s[o]);break;case 31:this.$=s[o-1].concat([s[o]]);break;case 33:case 37:this.$=s[o];break;case 34:this.$=s[o-2].concat(s[o]);break;case 35:this.$={type:"sequence",nestedUnits:s[o-1]};break;case 36:this.$={type:"sequence",nestedUnits:[]}}},table:[e([5,7,12,13,15,21,26,30,31],t,{3:1,4:2,22:3,18:4,19:n}),{1:[3]},{5:[1,6]},{5:[2,37]},e(r,[2,36],{33:7,32:8,28:9,29:10,20:11,11:14,16:15,14:20,6:21,7:a,12:s,13:i,15:o,21:u,26:c,30:l,31:h}),e(p,t,{18:24,19:n}),{1:[2,1]},e(r,t,{18:25,19:[1,26]}),e(m,[2,33],{11:14,29:27,12:s,13:i,30:l,31:h}),e(f,[2,28]),e(m,[2,32],{28:9,29:10,20:11,11:14,16:15,14:20,6:21,32:28,7:a,12:s,13:i,15:o,21:u,26:c,30:l,31:h}),e(f,[2,23],{9:29,8:30,7:[1,32],10:[1,31]}),e(v,[2,25]),e(v,[2,26]),e(v,[2,27]),e(y,[2,15]),e([7,12,13,15,21,23,25,26,30,31],t,{18:4,22:33,19:n}),e([7,12,13,15,21,26,27,30,31],t,{18:4,22:34,19:n}),e(v,[2,7]),e(v,[2,8]),e(y,[2,10]),{14:35,15:o,17:[1,36]},e(y,[2,9]),e([15,17],[2,2]),e(p,[2,13]),e(r,[2,35]),e(r,t,{28:9,29:10,20:11,11:14,16:15,14:20,6:21,18:24,32:37,7:a,12:s,13:i,15:o,19:n,21:u,26:c,30:l,31:h}),e(m,[2,31],{28:9,29:10,20:11,11:14,16:15,14:20,6:21,32:38,7:a,12:s,13:i,15:o,21:u,26:c,30:l,31:h}),e(m,[2,30],{11:14,29:27,12:s,13:i,30:l,31:h}),e(f,[2,24]),e(f,[2,4],{10:[1,39]}),e(f,[2,6]),e([5,10,12,13,19,23,24,25,27,30,31],[2,3]),{23:[1,40],25:[1,41]},{27:[1,42]},e(y,[2,11]),{6:43,7:a},e(m,[2,34],{11:14,29:27,12:s,13:i,30:l,31:h}),e(m,[2,29],{11:14,29:27,12:s,13:i,30:l,31:h}),e(f,[2,5]),e(g,t,{18:4,22:44,19:n}),e(g,t,{18:4,22:45,19:n}),e(y,[2,18]),{14:46,15:o},{24:[1,47]},{24:[1,48]},e(y,[2,12]),e(y,[2,16]),e(y,[2,17])],defaultActions:{3:[2,37],6:[2,1]},parseError:function(e,t){if(!t.recoverable){var n=new Error(e);throw n.hash=t,n}this.trace(e)},parse:function(e){var t=this,n=[0],r=[null],a=[],s=this.table,i="",o=0,u=0,c=0,l=a.slice.call(arguments,1),h=Object.create(this.lexer),p={yy:{}};for(var m in this.yy)Object.prototype.hasOwnProperty.call(this.yy,m)&&(p.yy[m]=this.yy[m]);h.setInput(e,p.yy),p.yy.lexer=h,p.yy.parser=this,void 0===h.yylloc&&(h.yylloc={});var f=h.yylloc;a.push(f);var v=h.options&&h.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var y,g,_,d,S,w,L,x,E,C=function(){var e;return"number"!=typeof(e=h.lex()||1)&&(e=t.symbols_[e]||e),e},A={};;){if(_=n[n.length-1],this.defaultActions[_]?d=this.defaultActions[_]:(null!==y&&void 0!==y||(y=C()),d=s[_]&&s[_][y]),void 0===d||!d.length||!d[0]){var U="";for(w in E=[],s[_])this.terminals_[w]&&w>2&&E.push("'"+this.terminals_[w]+"'");U=h.showPosition?"Parse error on line "+(o+1)+":\n"+h.showPosition()+"\nExpecting "+E.join(", ")+", got '"+(this.terminals_[y]||y)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==y?"end of input":"'"+(this.terminals_[y]||y)+"'"),this.parseError(U,{text:h.match,token:this.terminals_[y]||y,line:h.yylineno,loc:f,expected:E})}if(d[0]instanceof Array&&d.length>1)throw new Error("Parse Error: multiple actions possible at state: "+_+", token: "+y);switch(d[0]){case 1:n.push(y),r.push(h.yytext),a.push(h.yylloc),n.push(d[1]),y=null,g?(y=g,g=null):(u=h.yyleng,i=h.yytext,o=h.yylineno,f=h.yylloc,c>0&&c--);break;case 2:if(L=this.productions_[d[1]][1],A.$=r[r.length-L],A._$={first_line:a[a.length-(L||1)].first_line,last_line:a[a.length-1].last_line,first_column:a[a.length-(L||1)].first_column,last_column:a[a.length-1].last_column},v&&(A._$.range=[a[a.length-(L||1)].range[0],a[a.length-1].range[1]]),void 0!==(S=this.performAction.apply(A,[i,u,o,p.yy,d[1],r,a].concat(l))))return S;L&&(n=n.slice(0,-1*L*2),r=r.slice(0,-1*L),a=a.slice(0,-1*L)),n.push(this.productions_[d[1]][0]),r.push(A.$),a.push(A._$),x=s[n[n.length-2]][n[n.length-1]],n.push(x);break;case 3:return!0}}return!0}},d={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var a=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[a[0],a[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,r,a;if(this.options.backtrack_lexer&&(a={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(a.yylloc.range=this.yylloc.range.slice(0))),(r=e[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var s in a)this[s]=a[s];return!1}return!1},next:function(){if(this.done)return this.EOF;var e,t,n,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),s=0;s<a.length;s++)if((n=this._input.match(this.rules[a[s]]))&&(!t||n[0].length>t[0].length)){if(t=n,r=s,this.options.backtrack_lexer){if(!1!==(e=this.test_match(n,a[s])))return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?!1!==(e=this.test_match(t,a[r]))&&e:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e||this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return(e=this.conditionStack.length-1-Math.abs(e||0))>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,r){switch(n){case 0:return"WHITESPACE";case 1:return"NUMBER";case 2:return"DASH";case 3:return"LONG_FAMILY";case 4:return"PRIME";case 5:return"PAUSE";case 6:return"COMMENT_SHORT";case 7:return"COMMENT_LONG";case 8:return"NEWLINE";case 9:return"OPEN_BRACKET";case 10:return"CLOSE_BRACKET";case 11:return"OPEN_PARENTHESIS";case 12:return"CLOSE_PARENTHESIS";case 13:return"COMMA";case 14:return"COLON";case 15:return"EOF";case 16:return"INVALID"}},rules:[/^(?:[^\S\r\n]+)/,/^(?:[0-9]+)/,/^(?:-)/,/^(?:[_A-Za-z]+)/,/^(?:')/,/^(?:\.)/,/^(?:\/\/[^\n\r]*)/,/^(?:\/\*[^]*?\*\/)/,/^(?:[\n\r])/,/^(?:\[)/,/^(?:\])/,/^(?:\()/,/^(?:\))/,/^(?:,)/,/^(?::)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],inclusive:!0}}};function S(){this.yy={}}return _.lexer=d,S.prototype=_,_.Parser=S,new S}();t.parser=r,t.Parser=r.Parser,t.parse=function(){return r.parse.apply(r,arguments)}},function(e,t,n){"use strict";var r=!0;class AlgPart{freeze(){Object.freeze(this)}}class Unit extends AlgPart{}class Annotation extends Unit{}class UnitWithAmount extends Unit{constructor(e=1){super(),this.amount=e}}class BaseMove extends UnitWithAmount{}class alg_part_Sequence extends AlgPart{constructor(e){for(var t of(super(),this.nestedUnits=e,this.type="sequence",e))if(r&&!(t instanceof Unit))throw"A Sequence can only contain `Unit`s.";Object.freeze(this.nestedUnits),this.freeze()}}class Group extends UnitWithAmount{constructor(e,t){super(t),this.nestedSequence=e,this.type="group",this.freeze()}}class Commutator extends UnitWithAmount{constructor(e,t,n){super(n),this.A=e,this.B=t,this.type="commutator",this.freeze()}}class Conjugate extends UnitWithAmount{constructor(e,t,n){super(n),this.A=e,this.B=t,this.type="conjugate",this.freeze()}}class Pause extends Unit{constructor(){super(),this.type="pause",this.freeze()}}class NewLine extends Annotation{constructor(){super(),this.type="newLine",this.freeze()}}class CommentShort extends Annotation{constructor(e){super(),this.comment=e,this.type="commentShort",this.freeze()}}class CommentLong extends Annotation{constructor(e){super(),this.comment=e,this.type="commentLong",this.freeze()}}class sign_move_SiGNMove extends BaseMove{constructor(e,t,n,r){super(r),this.family=n,this.type="signMove",this.outerLayer=e,this.innerLayer=t,this.freeze()}}function a(e,t){return new sign_move_SiGNMove(void 0,void 0,e,t)}function s(e,t,n){return new sign_move_SiGNMove(void 0,e,t,n)}function i(e,t,n,r){return new sign_move_SiGNMove(e,t,n,r)}function o(e,t,n){switch(t.type){case"sequence":if(r&&!(t instanceof alg_part_Sequence))throw`Alg part is not an object of type Sequence despite having "type": "${t.type}"`;return e.traverseSequence(t,n);case"group":if(r&&!(t instanceof Group))throw`Alg part is not an object of type Group despite having "type": "${t.type}"`;return e.traverseGroup(t,n);case"signMove":if(r&&!(t instanceof sign_move_SiGNMove))throw`Alg part is not an object of type SiGNMove despite having "type": "${t.type}"`;return e.traverseSiGNMove(t,n);case"commutator":if(r&&!(t instanceof Commutator))throw`Alg part is not an object of type Commutator despite having "type": "${t.type}"`;return e.traverseCommutator(t,n);case"conjugate":if(r&&!(t instanceof Conjugate))throw`Alg part is not an object of type Conjugate despite having "type": "${t.type}"`;return e.traverseConjugate(t,n);case"pause":if(r&&!(t instanceof Pause))throw`Alg part is not an object of type Pause despite having "type": "${t.type}"`;return e.traversePause(t,n);case"newLine":if(r&&!(t instanceof NewLine))throw`Alg part is not an object of type NewLine despite having "type": "${t.type}"`;return e.traverseNewLine(t,n);case"commentShort":if(r&&!(t instanceof CommentShort))throw`Alg part is not an object of type CommentShort despite having "type": "${t.type}"`;return e.traverseCommentShort(t,n);case"commentLong":if(r&&!(t instanceof CommentLong))throw`Alg part is not an object of type CommentLong despite having "type": "${t.type}"`;return e.traverseCommentLong(t,n);default:throw`Unknown algPart type: ${t.type}`}}class traversal_TraversalDownUp{traverse(e,t){return o(this,e,t)}traverseIntoUnit(e,t){var n=this.traverse(e,t);if(r&&!(n instanceof Unit))throw"Traversal did not produce a unit as expected.";return n}}class traversal_TraversalUp extends traversal_TraversalDownUp{traverse(e){return o(this,e,void 0)}traverseIntoUnit(e){var t=this.traverse(e);if(r&&!(t instanceof Unit))throw"Traversal did not produce a unit as expected.";return t}}const u=new class traversal_Invert extends traversal_TraversalUp{traverseSequence(e){return new alg_part_Sequence(e.nestedUnits.slice().reverse().map(e=>this.traverseIntoUnit(e)))}traverseGroup(e){return new Group(this.traverseSequence(e.nestedSequence),e.amount)}traverseSiGNMove(e){return new sign_move_SiGNMove(e.outerLayer,e.innerLayer,e.family,-e.amount)}traverseCommutator(e){return new Commutator(e.B,e.A,e.amount)}traverseConjugate(e){return new Conjugate(e.A,this.traverseSequence(e.B),e.amount)}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}},c=new class traversal_Expand extends traversal_TraversalUp{flattenSequenceOneLevel(e){var t=[];for(var n of e)if(n instanceof alg_part_Sequence)t=t.concat(n.nestedUnits);else{if(!(n instanceof Unit))throw"expand() encountered an internal error. Did you pass in a valid Algorithm?";t.push(n)}return t}repeat(e,t){var n,r=Math.abs(t.amount);n=-1==(t.amount>0?1:-1)?m(new alg_part_Sequence(e)).nestedUnits:e;for(var a=[],s=0;s<r;s++)a=a.concat(n);return new alg_part_Sequence(a)}traverseSequence(e){return new alg_part_Sequence(this.flattenSequenceOneLevel(e.nestedUnits.map(e=>this.traverse(e))))}traverseGroup(e){return this.repeat(this.flattenSequenceOneLevel([this.traverse(e.nestedSequence)]),e)}traverseSiGNMove(e){return e}traverseCommutator(e){var t=this.traverseSequence(e.A),n=this.traverseSequence(e.B),r=[];return r=r.concat(t,n,m(t),m(n)),this.repeat(this.flattenSequenceOneLevel(r),e)}traverseConjugate(e){var t=this.traverseSequence(e.A),n=this.traverseSequence(e.B),r=[];return r=r.concat(t,n,m(t)),this.repeat(this.flattenSequenceOneLevel(r),e)}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}},l=new class traversal_StructureEquals extends traversal_TraversalDownUp{traverseSequence(e,t){if(!(t instanceof alg_part_Sequence))return!1;if(e.nestedUnits.length!==t.nestedUnits.length)return!1;for(var n=0;n<e.nestedUnits.length;n++)if(!this.traverse(e.nestedUnits[n],t.nestedUnits[n]))return!1;return!0}traverseGroup(e,t){return t instanceof Group&&this.traverse(e.nestedSequence,t.nestedSequence)}traverseSiGNMove(e,t){return t instanceof sign_move_SiGNMove&&e.outerLayer===t.outerLayer&&e.innerLayer===t.innerLayer&&e.family===t.family&&e.amount===t.amount}traverseCommutator(e,t){return t instanceof Commutator&&this.traverse(e.A,t.A)&&this.traverse(e.B,t.B)}traverseConjugate(e,t){return t instanceof Conjugate&&this.traverse(e.A,t.A)&&this.traverse(e.B,t.B)}traversePause(e,t){return t instanceof Pause}traverseNewLine(e,t){return t instanceof NewLine}traverseCommentShort(e,t){return t instanceof CommentShort&&e.comment==t.comment}traverseCommentLong(e,t){return t instanceof CommentLong&&e.comment==t.comment}},h=new class traversal_CoalesceBaseMoves extends traversal_TraversalUp{sameBlock(e,t){return e.outerLayer===t.outerLayer&&e.innerLayer===t.innerLayer&&e.family===t.family}traverseSequence(e){var t=[];for(var n of e.nestedUnits)if(n instanceof sign_move_SiGNMove)if(t.length>0){var r=t[t.length-1];if(r instanceof sign_move_SiGNMove&&this.sameBlock(r,n)){var a=r.amount+n.amount;t.pop(),0!==a&&t.push(new sign_move_SiGNMove(n.outerLayer,n.innerLayer,n.family,a))}else t.push(n)}else t.push(n);else t.push(this.traverseIntoUnit(n));return new alg_part_Sequence(t)}traverseGroup(e){return e}traverseSiGNMove(e){return e}traverseCommutator(e){return e}traverseConjugate(e){return e}traversePause(e){return e}traverseNewLine(e){return e}traverseCommentShort(e){return e}traverseCommentLong(e){return e}},p=new class traversal_ToString extends traversal_TraversalUp{repetitionSuffix(e){var t=Math.abs(e),n="";return 1!==t&&(n+=String(t)),t!==e&&(n+="'"),n}spaceBetween(e,t){return e instanceof Pause&&t instanceof Pause?"":" "}traverseSequence(e){var t="";if(e.nestedUnits.length>0){t+=this.traverse(e.nestedUnits[0]);for(var n=1;n<e.nestedUnits.length;n++)t+=this.spaceBetween(e.nestedUnits[n-1],e.nestedUnits[n]),t+=this.traverse(e.nestedUnits[n])}return t}traverseGroup(e){return"("+this.traverse(e.nestedSequence)+")"+this.repetitionSuffix(e.amount)}traverseSiGNMove(e){var t=e.family+this.repetitionSuffix(e.amount);return void 0!==e.innerLayer&&(t=String(e.innerLayer)+t,void 0!==e.outerLayer&&(t=String(e.outerLayer)+"-"+t)),t}traverseCommutator(e){return"["+this.traverse(e.A)+", "+this.traverse(e.B)+"]"+this.repetitionSuffix(e.amount)}traverseConjugate(e){return"["+this.traverse(e.A)+": "+this.traverse(e.B)+"]"+this.repetitionSuffix(e.amount)}traversePause(e){return"."}traverseNewLine(e){return"\n"}traverseCommentShort(e){return"//"+e.comment}traverseCommentLong(e){return"/*"+e.comment+"*/"}},m=u.traverseSequence.bind(u),f=c.traverseSequence.bind(c),v=l.traverseSequence.bind(l),y=h.traverseSequence.bind(h),g=p.traverseSequence.bind(p);p.traverse.bind(p),p.traverse.bind(p);var _;function d(e){if("sequence"!==e.type)throw`Expected Sequence while parsing, got: ${e.type}`;if(!e.nestedUnits)throw"Missing nestedUnits";return new alg_part_Sequence(e.nestedUnits.map(e=>(function(e){switch(e.type){case"sequence":throw"Expected AlgPart while parsing, got `Sequence`.";case"group":if(!e.nestedSequence)throw"Missing nestedSequence";if(!e.amount)throw"Missing amount";return new Group(d(e.nestedSequence),e.amount);case"signMove":if(!e.family)throw"Missing family";if(!e.amount)throw"Missing amount";return new sign_move_SiGNMove(e.outerLayer,e.innerLayer,e.family,e.amount);case"commutator":if(!e.A)throw"Missing A";if(!e.B)throw"Missing B";if(!e.amount)throw"Missing amount";return new Commutator(d(e.A),d(e.B),e.amount);case"conjugate":if(!e.A)throw"Missing A";if(!e.B)throw"Missing B";if(!e.amount)throw"Missing amount";return new Conjugate(d(e.A),d(e.B),e.amount);case"pause":return new Pause;case"newLine":return new NewLine;case"commentShort":if(!e.comment)throw"Missing comment";return new CommentShort(e.comment);case"commentLong":if(!e.comment)throw"Missing comment";return new CommentLong(e.comment);default:throw`Unknown alg type: ${e.type}`}})(e)))}!function(e){e.Sune=new alg_part_Sequence([a("R",1),a("U",1),a("R",-1),a("U",1),a("R",1),a("U",-2),a("R",-1)]),e.AntiSune=new alg_part_Sequence([a("R",1),a("U",2),a("R",-1),a("U",-1),a("R",1),a("U",-1),a("R",-1)]),e.SuneCommutator=new alg_part_Sequence([new Commutator(new alg_part_Sequence([a("R",1),a("U",1),a("R",-2)]),new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("R",1)]),new alg_part_Sequence([a("U",1)]),1)]),1)]),e.Niklas=new alg_part_Sequence([a("R",1),a("U",-1),a("L",-1),a("U",1),a("R",-1),a("U",-1),a("L",1),a("U",1)]),e.EPerm=new alg_part_Sequence([a("x",-1),new Commutator(new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("R",1)]),new alg_part_Sequence([a("U",-1)]))]),new alg_part_Sequence([a("D",1)]),1),new Commutator(new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("R",1)]),new alg_part_Sequence([a("U",1)]))]),new alg_part_Sequence([a("D",1)]),1),a("x",1)]),e.FURURFCompact=new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("F",1)]),new alg_part_Sequence([new Commutator(new alg_part_Sequence([a("U",1)]),new alg_part_Sequence([a("R",1)]),1)]),1)]),e.APermCompact=new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("R",2)]),new alg_part_Sequence([new Commutator(new alg_part_Sequence([a("F",2)]),new alg_part_Sequence([a("R",-1),a("B",-1),a("R",1)]),1)]),1)]),e.FURURFMoves=new alg_part_Sequence([a("F",1),a("U",1),a("R",1),a("U",-1),a("R",-1),a("F",-1)]),e.TPerm=new alg_part_Sequence([a("R",1),a("U",1),a("R",-1),a("U",-1),a("R",-1),a("F",1),a("R",2),a("U",-1),a("R",-1),a("U",-1),a("R",1),a("U",1),a("R",-1),a("F",-1)]),e.HeadlightSwaps=new alg_part_Sequence([new Conjugate(new alg_part_Sequence([a("F",1)]),new alg_part_Sequence([new Commutator(new alg_part_Sequence([a("R",1)]),new alg_part_Sequence([a("U",1)]),3)]),1)]),e.TriplePause=new alg_part_Sequence([new Pause,new Pause,new Pause]),e.AllAlgParts=[new alg_part_Sequence([a("R",1),a("U",-1)]),new Group(new alg_part_Sequence([a("F",1)]),2),a("R",2),new Commutator(new alg_part_Sequence([a("R",2)]),new alg_part_Sequence([a("U",2)]),2),new Conjugate(new alg_part_Sequence([a("L",2)]),new alg_part_Sequence([a("D",-1)]),2),new Pause,new NewLine,new CommentShort("short comment"),new CommentLong("long comment")]}(_||(_={}));var S=n(0);class ValidationError extends Error{}class validation_ValidatorTraversal extends traversal_TraversalUp{}function w(e,t){for(var n of t)if(!0===n[e])return!0;return!1}var L={x:!0,y:!0,z:!0,M:!0,E:!0,S:!0,m:!0,e:!0,s:!0},x={U:!0,L:!0,F:!0,R:!0,B:!0,D:!0},E={u:!0,l:!0,f:!0,r:!0,b:!0,d:!0,Uw:!0,Lw:!0,Fw:!0,Rw:!0,Bw:!0,Dw:!0};class BaseMoveValidator extends validation_ValidatorTraversal{traverseSequence(e){for(var t of e.nestedUnits)this.traverse(t)}traverseGroup(e){return this.traverse(e.nestedSequence)}traverseCommutator(e){this.traverse(e.A),this.traverse(e.B)}traverseConjugate(e){this.traverse(e.A),this.traverse(e.B)}traversePause(e){}traverseNewLine(e){}traverseCommentShort(e){}traverseCommentLong(e){}}const C=new class SiGNMoveValidator extends BaseMoveValidator{traverseSiGNMove(e){if(void 0===e.outerLayer)if(void 0===e.innerLayer){if(!w(e.family,[E,x,L]))throw new ValidationError(`Invalid SiGN plain move family: ${e.family}`)}else{if(!w(e.family,[E,x]))throw new ValidationError(`The provided SiGN move family is invalid, or cannot have an inner slice: ${e.family}`);if(e.innerLayer<=0)throw new ValidationError("Cannot have an inner layer of 0 or less.")}else{if(void 0===e.innerLayer)throw new ValidationError("A SiGNMove with an outer layer must have an inner layer.");if(!w(e.family,[E]))throw new ValidationError(`The provided SiGN move family is invalid, or cannot have an outer and inner layer: ${e.family}`);if(e.outerLayer<=0)throw new ValidationError("Cannot have an outer layer of 0 or less.");if(e.outerLayer>=e.innerLayer)throw new ValidationError("The outer layer must be less than the inner layer.")}}},A=C.traverse.bind(C),U=new class FlatAlgValidator extends validation_ValidatorTraversal{traverseSequence(e){for(var t of e.nestedUnits)this.traverse(t)}traverseGroup(e){throw new ValidationError("A flat alg cannot contain a group.")}traverseSiGNMove(e){}traverseCommutator(e){throw new ValidationError("A flat alg cannot contain a commutator.")}traverseConjugate(e){throw new ValidationError("A flat alg cannot contain a conjugate.")}traversePause(e){}traverseNewLine(e){}traverseCommentShort(e){}traverseCommentLong(e){}},N=U.traverse.bind(U),b=function(e){A(e),N(e)};function q(e,t={validators:[]}){t.validators=t.validators||[];const n=d(Object(S.parse)(e));for(var r of t.validators)r(n);return n}const M={73:a("R"),75:a("R",-1),87:a("B"),79:a("B",-1),83:a("D"),76:a("D",-1),68:a("L"),69:a("L",-1),74:a("U"),70:a("U",-1),72:a("F"),71:a("F",-1),78:a("F"),86:a("F",-1),67:a("l"),82:a("l",-1),85:a("r"),77:a("r",-1),84:a("x"),89:a("x"),66:a("x",-1),186:a("y"),59:a("y"),65:a("y",-1),80:a("z"),81:a("z",-1),190:a("M",-1)};function P(e){return e.altKey||e.ctrlKey?null:M[e.keyCode]||null}function O(e){var t=g(e);return t=(t=(t=t.replace(/_/g,"&#95;").replace(/ /g,"_")).replace(/\+/g,"&#2b;")).replace(/-/g,"&#45;").replace(/'/g,"-")}function k(e){var t=e;return q(t=(t=(t=t.replace(/-/g,"'").replace(/&#45;/g,"-")).replace(/\+/g," ").replace(/&#2b;/g,"+")).replace(/_/g," ").replace(/&#95;/g,"_"))}function T(e){return k(new URLSearchParams(window.location.search).get(e)||"")}function R(e){var t=new URL("https://alg.cubing.net");if(!e.alg)throw"An alg parameter is required.";if(t.searchParams.set("alg",O(e.alg)),e.setup&&t.searchParams.set("setup",O(e.setup)),e.puzzle){if(-1===["1x1x1","2x2x2","3x3x3","4x4x4","5x5x5","6x6x6","7x7x7","8x8x8","9x9x9","10x10x10","11x11x11","12x12x12","13x13x13","14x14x14","16x16x16","17x17x17"].indexOf(e.puzzle))throw`Invalid puzzle parameter: ${e.puzzle}`;t.searchParams.set("puzzle",e.puzzle)}if(e.stage){if(-1===["full","cross","F2L","LL","OLL","PLL","CLS","ELS","L6E","CMLL","WV","ZBLL","void"].indexOf(e.stage))throw`Invalid stage parameter: ${e.stage}`;t.searchParams.set("stage",e.stage)}if(e.view){if(-1===["editor","playback","fullscreen"].indexOf(e.view))throw`Invalid view parameter: ${e.view}`;t.searchParams.set("view",e.view)}if(e.type){if(-1===["moves","reconstruction","alg","reconstruction-end-with-setup"].indexOf(e.type))throw`Invalid type parameter: ${e.type}`;t.searchParams.set("type",e.type)}return t.toString()}n.d(t,"AlgPart",function(){return AlgPart}),n.d(t,"Unit",function(){return Unit}),n.d(t,"UnitWithAmount",function(){return UnitWithAmount}),n.d(t,"BaseMove",function(){return BaseMove}),n.d(t,"Sequence",function(){return alg_part_Sequence}),n.d(t,"Group",function(){return Group}),n.d(t,"SiGNMove",function(){return sign_move_SiGNMove}),n.d(t,"BareSiGNMove",function(){return a}),n.d(t,"LayerSiGNMove",function(){return s}),n.d(t,"RangeSiGNMove",function(){return i}),n.d(t,"Commutator",function(){return Commutator}),n.d(t,"Conjugate",function(){return Conjugate}),n.d(t,"Pause",function(){return Pause}),n.d(t,"NewLine",function(){return NewLine}),n.d(t,"CommentShort",function(){return CommentShort}),n.d(t,"CommentLong",function(){return CommentLong}),n.d(t,"TraversalDownUp",function(){return traversal_TraversalDownUp}),n.d(t,"TraversalUp",function(){return traversal_TraversalUp}),n.d(t,"invert",function(){return m}),n.d(t,"expand",function(){return f}),n.d(t,"structureEquals",function(){return v}),n.d(t,"coalesceBaseMoves",function(){return y}),n.d(t,"algToString",function(){return g}),n.d(t,"Example",function(){return _}),n.d(t,"fromJSON",function(){return d}),n.d(t,"parse",function(){return q}),n.d(t,"keyToMove",function(){return P}),n.d(t,"validateSiGNMoves",function(){return A}),n.d(t,"validateFlatAlg",function(){return N}),n.d(t,"validateSiGNAlg",function(){return b}),n.d(t,"ValidationError",function(){return ValidationError}),n.d(t,"serializeURLParam",function(){return O}),n.d(t,"deserializeURLParam",function(){return k}),n.d(t,"algCubingNetLink",function(){return R}),n.d(t,"getAlgURLParam",function(){return T})}])});
//# sourceMappingURL=alg.js.map